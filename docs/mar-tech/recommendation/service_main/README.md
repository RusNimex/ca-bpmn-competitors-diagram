# Модуль импорта МСБ

**Зачем:** Рекомендации на базе текущей выборки нерелевантны. Модуль насыщает систему данными российских компаний (2GIS) для повышения релевантности и апсейла.

**Кто:** Сотрудник (RBAC role ≥ employee) — загружает CSV, сопоставляет аккаунты, добавляет на дашборд МСБ.

**Как это работает:**
1. Сотрудник выбирает индустрию и загружает CSV (до 500 МБ).
2. Файл обрабатывается **асинхронно** в фоне; на экране — прогресс.
3. После загрузки: статистика по соцсетям (новые / сопоставленные).
4. «Сопоставить» — проверка, есть ли аккаунт уже в системе.
5. «Добавить на дашборд МСБ» — идентификация через Social API и добавление.

**Архитектура:**
```
Админка (Import2GISAction) → exec() → CLI (BackgroundImport2GisCommand)
              │                              │
              │    import_id                 │ processCsvImport()
              ↓                              ↓
    Страница прогресса ← Yii Cache ←── промежуточный прогресс (каждые 100 строк или 1 сек)
              │                              │
              │                              ↓
              └────────────────────── MySQL (БД msb) — результаты импорта
```

**Стек:** PHP, Yii 1.x, MySQL (БД `msb`), Yii Cache (прогресс; бэкенд — Redis/File).

**Ключевые требования:**
- Асинхронная обработка (FR-002)
- Без дубликатов, транзакционность (FR-004, FR-005)
- Битые категории (>532 символов) — обрезка, лог, отображение (FR-007, FR-008)
- Источник: CSV 2GIS, UTF-8

**Документы:**
- [SRS_msb_v1.md](SRS_msb_v1.md) — полные требования v1
- [TDD_msb_v1.md](TDD_msb_v1.md) — техдизайн (yiic backgroundImport2Gis, exec) v1
- [diagramm/sequence.puml](diagramm/sequence.puml) — диаграмма последовательности
