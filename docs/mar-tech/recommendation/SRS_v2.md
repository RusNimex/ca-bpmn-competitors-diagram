Версия 2.0

> **Область:** Расширение [SRS_v1.md](SRS_v1.md). Стратегии 1 и 2 описаны в v1. Данный документ добавляет стратегии 3 (МСБ) и 4 (композит).

# Зависимости

- [SRS_v1.md](SRS_v1.md) — базовые требования, роли, функциональные/нефункциональные, ограничения. Стратегии 1 и 2.
- Все правила из v1 остаются в силе (BR-003, BR-004, BR-005, FR-001–FR-013, NFR-001, NFR-002, CON-001–CON-003).

# Глоссарий (дополнение к v1)

| Термин | Определение |
|--------|-------------|
| **МСБ** | Малый и средний бизнес. Сегмент и источник аккаунтов для стратегии 3 (база компаний с категориями, подкатегориями и геолокациями). |
| **Сегмент** | Региональный, городской или локальный масштаб аккаунта/компании. Используется для фильтрации в стратегии 3. |
| **Композит** | Объединение стратегий с fallback: при пустом списке — переход к следующей стратегии. |
| **Fallback** | Резервный переход на другую стратегию, если текущая вернула пустой результат. |

# Бизнес правила (стратегии 3 и 4)

| ID | Правило |
|----|---------|
| BR-v2-001 | Стратегия 3 (МСБ). По категории бизнеса. Используется, когда целевой аккаунт (по которому подбираются рекомендации) есть в базе МСБ. Источник рекомендаций — база компаний МСБ с категориями, подкатегориями и геолокациями. Подбор ведётся по той же категории бизнеса и по сегменту (региональный, городской, локальный). |
| BR-v2-002 | Стратегия 4. Композит (fallback). Объединение стратегий 1, 2 и 3. Последовательно выполняется каждая стратегия до первой, которая вернула непустой список. Порядок по умолчанию: 1 → 2 → 3. Виджет скрывается только если все стратегии вернули пустой результат. |
| BR-v2-003 | Сегментация предотвращает нерелевантные рекомендации (например, местному магазину не предлагать федеральную сеть). |

# Пользовательские требования (стратегии 3 и 4)

| ID | Требование |
|----|------------|
| UR-v2-001 | Пользователь может получить рекомендации по категории бизнеса (стратегия 3) с учётом сегмента. |
| UR-v2-002 | При пустом результате по одной стратегии пользователь получает результат по следующей (стратегия 4). Виджет не скрывается, пока не исчерпаны все стратегии. |

# Контракты и интеграции

- [OpenAPI v2](openapi_v2.yaml) — эндпоинт `GET /api/v1/account_recommendation`. Параметры: algo (PBUW, CATG, MSB, COMPOSITE), social, socialId, simple, limit, debug.

# Связь стратегий

| Стратегия | Параметр algo | Доп. параметры | Источник данных | Документ |
|-----------|---------------|----------------|-----------------|----------|
| 1 | PBUW или не передан | — | Коллаборативная фильтрация | SRS_v1 |
| 2 | CATG | social, socialId | Категория соцсети | SRS_v1 |
| 3 | MSB | social, socialId | МСБ, категория бизнеса, сегмент | SRS_v2 |
| 4 | COMPOSITE или social+socialId без algo | social, socialId | Fallback 1→2→3 | SRS_v2 |
