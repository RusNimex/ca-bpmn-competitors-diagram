@startuml kino find/choice

title "UR-001, UR-002: Поиск фильма и просмотр расписания"

start
:Открыть каталог;
:Ввести поиск (название, время, жанр);
if (Фильмы найдены?) then (да)
  :Показать список;
  :Выбрать фильм;
  :Показать детали и расписание (FR-001);
else (нет)
  :Показать "ничего не найдено";
endif
stop
@enduml

@startuml kino seats_reservation

title "UR-003, FR-002–FR-006: Выбор мест и бронирование"

start
:Выбрать сеанс;
:Показать план зала, места, стоимость (FR-001);
:Выбрать места;
:POST /reservations {sessionId, seats[]};
if (Места свободны?) then (да)
  :Забронировать (FR-002, FR-004, FR-005);
  :Таймер 10 минут (FR-003);
  :reservationId + timer;
else (нет)
  :409 Conflict — места заняты;
endif
stop
@enduml

@startuml kino payment

title "UR-004, FR-007–FR-009, FR-013: Оплата и выдача билета"

start
:Есть бронирование (reservationId);
if (Аутентифицирован?) then (да)
else (нет)
  :Запросить телефон (FR-011);
  :POST /auth {phone};
endif
:POST /orders {reservationId, amount};
:Создать заказ, TTL 5 минут (FR-007);
:Открыть виджет оплаты (Pay API);
if (Оплата подтверждена?) then (да)
  :Webhook → подтверждение;
  :Выдать билеты (FR-009);
  :Отправить SMS со ссылкой (FR-013);
  :Билет на экране;
else (нет / таймаут)
  :Освободить места (FR-006);
  :Сообщить об ошибке;
endif
stop
@enduml

@startuml kino history

title "UR-005, FR-012: Просмотр истории покупок"

start
:Открыть раздел «Мои покупки»;
:Запросить историю (телефон / сессия);
:Показать список покупок;
stop
@enduml

@startuml kino cancel

title "UR-006, FR-008, BR-003: Отмена покупки"

start
:Открыть заказ в истории;
:Нажать «Отменить»;
if (До сеанса > 10 минут?) then (да)
  :Выполнить отмену;
  :Вернуть средства (Pay API);
  :Обновить историю;
else (нет)
  :Отмена невозможна (BR-003);
  :Сообщить пользователю;
endif
stop
@enduml
